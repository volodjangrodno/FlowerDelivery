{% extends 'flowers/base.html' %}

{% block title %}
    <title>История всех заказов</title>
{% endblock %}

{% block content %}
    <div class="container mt-5">
        <div class="d-grid gap-2 d-md-flex justify-content-md-end">
            <a href="{% url 'profile' %}" class="btn btn-danger me-md-2" type="button">Назад в профиль</a>
        </div>
    <h1 class="text-center mb-4">История всех заказов</h1>
    <!-- Форма для сортировки и фильтрации -->
    <form method="get" action="{% url 'all_orders_history' %}">
        <div class="d-flex align-items-center">
            <label class="me-2">Фильтры:</label>
            <input type="text" name="username" value="{{ username_filter }}" placeholder="Введите username пользователя" class="form-control me-2">
            <label class="me-2">C:</label>
            <input type="date" name="date_from" value="{{ date_from }}" class="form-control me-2" placeholder="Дата с">
            <label class="me-2">По:</label>
            <input type="date" name="date_to" value="{{ date_to }}" class="form-control me-2" placeholder="Дата по">

            <button type="submit" class="btn btn-primary">Применить</button>

            <button type="submit" name="sort" value="asc" class="btn">
                <i class="fas fa-arrow-up"></i> <!-- Иконка стрелка вверх -->
            </button>
            <button type="submit" name="sort" value="desc" class="btn">
                <i class="fas fa-arrow-down"></i> <!-- Иконка стрелка вниз -->
            </button>
        </div>
    </form><br>
    {% for order in orders %}
        <div class="card mb-3">
            <div class="card-body d-flex justify-content-between align-items-center">
                <div>
                    <h5 class="card-title">Заказ №{{ order.id }} от пользователя {{ order.user }} на сумму {{ order.total_price }} руб.</h5>
                    <p class="card-text">Статус: <span class="badge bg-success">{{ order.status }}</span></p>
                    <p class="card-text">Дата создания: {{ order.order_date|date:"d.m.Y H:i" }}</p>
                </div>
                <a href="{% url 'order_detail' order.id %}" class="btn btn-primary">Детали заказа</a>
            </div>
        </div>
    {% empty %}
        <div class="alert alert-warning" role="alert">
            <p>Нет заказов в истории.</p>
        </div>
    {% endfor %}
    <a href="{% url 'generate_sales_report' %}?username={{ username_filter }}&date_from={{ date_from }}&date_to={{ date_to }}">Отчёт по продажам</a>
</div>
{% endblock %}